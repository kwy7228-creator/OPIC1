<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AL Story Spoken English (Day 1–3)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{--bg:#f4f4f4;--card:#fff;--line:#e6e6e6;--muted:#666;--primary:#2563eb;}
    body{font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;background:var(--bg);margin:0;padding:16px;}
    .app{max-width:980px;margin:auto;background:var(--card);border-radius:12px;padding:16px 18px 20px;box-shadow:0 2px 12px rgba(0,0,0,.08);}
    h1{margin:0 0 10px;text-align:center;font-size:20px;}
    .top{display:flex;gap:10px;flex-wrap:wrap;justify-content:space-between;align-items:center;margin-bottom:10px;}
    select,button,textarea{font:inherit;}
    select{padding:6px 8px;border:1px solid #d5d5d5;border-radius:10px;background:#fff;}
    button{padding:8px 10px;border:1px solid #d5d5d5;border-radius:10px;background:#fff;cursor:pointer;}
    button.primary{background:var(--primary);border-color:var(--primary);color:#fff;}
    button:disabled{opacity:.55;cursor:not-allowed;}
    .section{border:1px solid var(--line);border-radius:12px;background:#fafafa;padding:12px;margin-top:12px;}
    .section h2{margin:0 0 8px;font-size:16px;}
    .muted{color:var(--muted);font-size:13px;}
    .hr{height:1px;background:var(--line);margin:10px 0;}
    .expr{padding:10px;border:1px solid var(--line);border-radius:12px;background:#fff;margin-top:8px;}
    .expr .p{font-weight:800;font-size:16px;}
    .expr .k{margin-top:4px;}
    .story{white-space:pre-wrap;line-height:1.6;background:#fff;border:1px solid var(--line);border-radius:12px;padding:10px;margin-top:8px;}
    .q{margin-top:10px;}
    textarea{width:100%;min-height:78px;border:1px solid #d5d5d5;border-radius:10px;padding:8px;box-sizing:border-box;background:#fff;}
    .options{display:flex;flex-direction:column;gap:8px;margin-top:8px;}
    .opt{border:1px solid #d5d5d5;background:#fff;border-radius:10px;padding:10px;cursor:pointer;}
    .opt:hover{background:#eef2ff;}
    .opt.correct{border-color:#16a34a;background:#ecfdf3;}
    .opt.wrong{border-color:#dc2626;background:#fef2f2;}
    .small{font-size:12px;color:var(--muted);}
    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .pill{display:inline-block;border:1px solid #d5d5d5;background:#fff;border-radius:999px;padding:3px 10px;font-size:12px;color:var(--muted);}
    .hidden{display:none;}
  </style>
</head>
<body>
<div class="app">
  <h1>AL Story-based Spoken English (Day 1–3)</h1>

  <div class="top">
    <div class="row">
      <span class="pill" id="dayPill">Day 1</span>
      <label class="small">Day</label>
      <select id="daySelect"></select>
      <label class="small">Voice</label>
      <select id="voiceSelect"></select>
      <label class="small">Speed</label>
      <select id="rateSelect">
        <option value="0.9">0.9</option>
        <option value="1.0" selected>1.0</option>
        <option value="1.1">1.1</option>
      </select>
    </div>
    <div class="row">
      <button class="primary" id="btnPlayStory">▶ Play Story</button>
      <button id="btnStop">■ Stop</button>
      <button id="btnToggleScript">Show / Hide Script</button>
    </div>
  </div>

  <!-- 1) Expressions -->
  <div class="section" id="secExpressions">
    <h2>1) Expressions (5) + Mini Situations</h2>
    <div class="muted">AL 포인트: “감정/완화/전환/회고” 계열 표현을 스토리 속에서 자연스럽게 쓰는 연습.</div>
    <div id="exprList"></div>
  </div>

  <!-- 2) Story -->
  <div class="section" id="secStory">
    <h2>2) Long Story (Audio-book)</h2>
    <div class="muted">먼저 오디오로 듣고, 필요할 때만 스크립트를 열어라.</div>
    <div id="storyBox" class="story hidden"></div>
  </div>

  <!-- 3a) Story understanding -->
  <div class="section" id="secUnderstand">
    <h2>3a) Story Understanding Questions</h2>
    <div id="understandBox"></div>
  </div>

  <!-- 3b) Expression quiz -->
  <div class="section" id="secExprQuiz">
    <h2>3b) Choose the Best Expression (Story Context)</h2>
    <div class="muted">스토리 상황에서 “가장 자연스러운 구어체”를 고르는 감각을 만든다.</div>
    <div id="exprQuizBox"></div>
  </div>

  <!-- 3c) AL speaking -->
  <div class="section" id="secSpeak">
    <h2>3c) Speak It Out (AL Style)</h2>
    <div class="muted">단답 금지. 이유/감정/결과까지 40~60초로 확장.</div>
    <div id="speakBox"></div>
  </div>
</div>

<script>
/* =========================
   DATA: Day 1–3
   ========================= */
const DAYS = [
  {
    day: 1,
    title: "The Meeting I Almost Skipped",
    expressions: [
      { phrase:"To be honest, ...", meaning:"솔직히 말해서 ...", nuance:"의견/감정 완충", mini:"To be honest, I wasn’t really in the mood." },
      { phrase:"I wasn’t really in the mood.", meaning:"그럴 기분이 아니었어", nuance:"거절/소극/컨디션", mini:"I wasn’t really in the mood to go out." },
      { phrase:"It caught me off guard.", meaning:"완전 예상 못 했어", nuance:"갑작스러움", mini:"The message caught me off guard." },
      { phrase:"Long story short, ...", meaning:"요약하면 말이야", nuance:"길어진 설명 정리", mini:"Long story short, I decided to go." },
      { phrase:"It worked out in the end.", meaning:"결국엔 잘 풀렸어", nuance:"결과 회고", mini:"It worked out in the end." },
    ],
    story: `Last Friday, I almost skipped a meeting that I had been looking forward to all week.

To be honest, I wasn’t really in the mood that morning.
I had stayed up late the night before, and everything felt rushed as soon as I woke up.
On top of that, I got an unexpected message from my manager asking if I could join an extra discussion.
It completely caught me off guard.

At first, I thought about canceling the original plan.
I felt overwhelmed and mentally drained, and staying home sounded like the easiest option.
Still, something didn’t sit right with me.
I had already committed, and backing out at the last minute didn’t feel responsible.

So I took a short break, cleared my head, and decided to go anyway.
When I arrived, I realized my worries had been exaggerated.
No one seemed upset, and the atmosphere was more relaxed than I expected.

Long story short, the meeting reminded me why those conversations matter.
Looking back, I’m glad I pushed myself to show up.
It wasn’t a perfect day, but it worked out in the end.`,
    understand: [
      "Why didn’t the speaker feel like going at first?",
      "What unexpected thing happened that morning?",
      "What made the speaker decide to go anyway?",
      "How did the meeting turn out compared to expectations?"
    ],
    exprQuiz: [
      {
        prompt:"You want to soften your honest feeling before you say it.",
        options:["To be honest, ...","It worked out in the end.","Long story short, ..."],
        answer:"To be honest, ..."
      },
      {
        prompt:"You receive an unexpected message and feel surprised.",
        options:["I wasn’t really in the mood.","It caught me off guard.","To be honest, ..."],
        answer:"It caught me off guard."
      },
      {
        prompt:"You want to summarize a long explanation.",
        options:["Long story short, ...","It worked out in the end.","It caught me off guard."],
        answer:"Long story short, ..."
      },
      {
        prompt:"You want to say things ended up fine overall.",
        options:["I wasn’t really in the mood.","It worked out in the end.","To be honest, ..."],
        answer:"It worked out in the end."
      },
      {
        prompt:"You didn’t feel like going out in the first place.",
        options:["It caught me off guard.","I wasn’t really in the mood.","Long story short, ..."],
        answer:"I wasn’t really in the mood."
      }
    ],
    speak: [
      "Tell me about a time you weren’t in the mood to do something, but you did it anyway. What happened and how did you feel afterward?",
      "Have you ever been caught off guard at work or in daily life? Explain the situation and how you handled it."
    ]
  },

  {
    day: 2,
    title: "The Plan That Didn’t Go as Expected",
    expressions: [
      { phrase:"Honestly, ...", meaning:"솔직히 말해서 ...", nuance:"감정/입장 완충", mini:"Honestly, I wasn’t sure how to feel." },
      { phrase:"I wasn’t sure how to feel.", meaning:"어떻게 느껴야 할지 애매했어", nuance:"감정 혼합", mini:"I wasn’t sure how to feel about it." },
      { phrase:"I didn’t mean to ~", meaning:"~하려던 건 아니야", nuance:"사과/완화", mini:"I didn’t mean to sound annoyed." },
      { phrase:"Things didn’t go as planned.", meaning:"계획대로 안 됐어", nuance:"변수/차질", mini:"Things didn’t go as planned." },
      { phrase:"Looking back, ...", meaning:"돌이켜보면 ...", nuance:"회고/교훈", mini:"Looking back, it wasn’t about the plan." },
    ],
    story: `A few weeks ago, I made plans with a close friend whom I hadn’t seen in a long time.

We had been talking about meeting up for months, so I was genuinely excited.
However, on the day we were supposed to meet, things didn’t go as planned.
My friend texted me saying he might be late, and honestly, I wasn’t sure how to feel about it.

At first, I tried to be understanding.
I told myself that things happen and that it wasn’t a big deal.
But as time passed, my excitement slowly turned into frustration.

When he finally arrived, I could tell he was stressed out.
He apologized and explained what happened.
I could hear it in his voice—he didn’t mean to mess things up.

We ended up changing our original plan and grabbed a quick meal instead.
It wasn’t what we imagined, but the conversation felt natural and honest.
We talked about work, life, and how hard it can be to stay connected as adults.

Looking back, the day wasn’t about the plan itself.
It was about making the effort to meet and talk.
And that’s why I was glad we didn’t cancel.`,
    understand: [
      "What was the original plan, and what went wrong?",
      "How did the speaker’s feelings change while waiting?",
      "What did the friend say or do to calm the situation?",
      "What was the main takeaway ‘looking back’?"
    ],
    exprQuiz: [
      {
        prompt:"You want to describe that the day didn’t happen the way you expected.",
        options:["Things didn’t go as planned.","Looking back, ...","I didn’t mean to ~"],
        answer:"Things didn’t go as planned."
      },
      {
        prompt:"You feel mixed emotions and can’t clearly label them.",
        options:["I wasn’t sure how to feel.","Honestly, ...","Looking back, ..."],
        answer:"I wasn’t sure how to feel."
      },
      {
        prompt:"You want to soften an apology or explanation: “I didn’t mean to sound annoyed.”",
        options:["I didn’t mean to ~","Things didn’t go as planned.","Honestly, ..."],
        answer:"I didn’t mean to ~"
      },
      {
        prompt:"You want to reflect and share a lesson from the situation.",
        options:["Looking back, ...","Honestly, ...","I wasn’t sure how to feel."],
        answer:"Looking back, ..."
      },
      {
        prompt:"You want to start a candid sentence without sounding harsh.",
        options:["Honestly, ...","Looking back, ...","Things didn’t go as planned."],
        answer:"Honestly, ..."
      }
    ],
    speak: [
      "Describe a time your plans didn’t go as planned. How did you respond, and what did you learn looking back?",
      "Tell me about a situation where you weren’t sure how to feel. What made it confusing, and how did you deal with it?"
    ]
  },

  {
    day: 3,
    title: "A Decision I Hesitated to Make",
    expressions: [
      { phrase:"I wasn’t fully convinced.", meaning:"완전히 납득/확신은 아니었어", nuance:"망설임/의심", mini:"I wasn’t fully convinced it was the right move." },
      { phrase:"I kept putting it off.", meaning:"계속 미뤘어", nuance:"결정/일 미루기", mini:"I kept putting it off for days." },
      { phrase:"I went back and forth.", meaning:"왔다 갔다 고민했어", nuance:"결정 흔들림", mini:"I went back and forth on it." },
      { phrase:"Long story short, ...", meaning:"요약하면 ...", nuance:"정리", mini:"Long story short, I had to decide for myself." },
      { phrase:"It worked out better than I expected.", meaning:"생각보다 더 잘 풀렸어", nuance:"긍정적 결과", mini:"It worked out better than I expected." },
    ],
    story: `Recently, I had to make a decision that I kept putting off.

I was offered an opportunity that sounded good on paper, but I wasn’t fully convinced.
Part of me was excited, while another part felt uncomfortable.
The offer came unexpectedly, and I felt pressured to respond quickly.

For days, I went back and forth.
I overthought every possible outcome and replayed worst-case scenarios in my head.
I talked to a few people I trusted and listened to their advice.
Some told me to take the risk, while others suggested playing it safe.

Long story short, no one could make the decision for me.
Eventually, I asked myself what I would regret more.
After thinking it through, I made my choice and moved forward.

It wasn’t easy, and I still had doubts at first.
But once I took action, things started to feel clearer.
Looking back, I’m glad I didn’t avoid the decision.
It worked out better than I expected, and it helped me grow.`,
    understand: [
      "What made the decision difficult for the speaker?",
      "What did the speaker do while hesitating?",
      "What question helped the speaker finally decide?",
      "How did the result turn out in the end?"
    ],
    exprQuiz: [
      {
        prompt:"You want to say you weren’t 100% sure it was right.",
        options:["I wasn’t fully convinced.","I kept putting it off.","It worked out better than I expected."],
        answer:"I wasn’t fully convinced."
      },
      {
        prompt:"You delayed the decision for several days.",
        options:["I went back and forth.","I kept putting it off.","Long story short, ..."],
        answer:"I kept putting it off."
      },
      {
        prompt:"You constantly changed your mind while deciding.",
        options:["I went back and forth.","I wasn’t fully convinced.","It worked out better than I expected."],
        answer:"I went back and forth."
      },
      {
        prompt:"You want to summarize the situation quickly.",
        options:["Long story short, ...","I kept putting it off.","I wasn’t fully convinced."],
        answer:"Long story short, ..."
      },
      {
        prompt:"You want to say the outcome was surprisingly positive.",
        options:["It worked out better than I expected.","I went back and forth.","I kept putting it off."],
        answer:"It worked out better than I expected."
      }
    ],
    speak: [
      "Tell me about a decision you kept putting off. Why did you hesitate, and what finally helped you decide?",
      "Have you ever gone back and forth about something important? Explain the situation and how it turned out."
    ]
  }
];

/* =========================
   APP LOGIC
   ========================= */
const daySelect = document.getElementById("daySelect");
const dayPill = document.getElementById("dayPill");
const exprList = document.getElementById("exprList");
const storyBox = document.getElementById("storyBox");
const understandBox = document.getElementById("understandBox");
const exprQuizBox = document.getElementById("exprQuizBox");
const speakBox = document.getElementById("speakBox");

const voiceSelect = document.getElementById("voiceSelect");
const rateSelect = document.getElementById("rateSelect");
const btnPlayStory = document.getElementById("btnPlayStory");
const btnStop = document.getElementById("btnStop");
const btnToggleScript = document.getElementById("btnToggleScript");

let currentDayIndex = 0;
let voices = [];

function initDays(){
  DAYS.forEach((d,i)=>{
    const o=document.createElement("option");
    o.value=i;
    o.textContent=`Day ${d.day}: ${d.title}`;
    daySelect.appendChild(o);
  });
  daySelect.addEventListener("change", ()=>{
    currentDayIndex = parseInt(daySelect.value,10);
    render();
  });
}

function initVoices(){
  voices = speechSynthesis.getVoices().filter(v=> (v.lang||"").toLowerCase().startsWith("en"));
  voiceSelect.innerHTML = "";
  const add = (v, idx)=>{
    const o=document.createElement("option");
    o.value=idx;
    o.textContent=`${v.name} (${v.lang})`;
    voiceSelect.appendChild(o);
  };
  if(voices.length===0){
    const o=document.createElement("option");
    o.value="-1";
    o.textContent="(No English voice found)";
    voiceSelect.appendChild(o);
  } else {
    voices.forEach(add);
    // try pick an en-US voice if exists
    const usIndex = voices.findIndex(v=> (v.lang||"").toLowerCase().includes("en-us"));
    voiceSelect.value = usIndex>=0 ? usIndex : "0";
  }
}
speechSynthesis.onvoiceschanged = initVoices;

function speak(text){
  speechSynthesis.cancel();
  const u = new SpeechSynthesisUtterance(text);
  u.lang = "en-US";
  const vi = parseInt(voiceSelect.value,10);
  if(voices[vi]) u.voice = voices[vi];
  u.rate = parseFloat(rateSelect.value || "1.0");
  speechSynthesis.speak(u);
}

btnPlayStory.addEventListener("click", ()=>{
  const d = DAYS[currentDayIndex];
  speak(d.story);
});

btnStop.addEventListener("click", ()=>{
  speechSynthesis.cancel();
});

btnToggleScript.addEventListener("click", ()=>{
  storyBox.classList.toggle("hidden");
});

function render(){
  const d = DAYS[currentDayIndex];
  dayPill.textContent = `Day ${d.day}`;
  // expressions
  exprList.innerHTML = d.expressions.map((e, idx)=>`
    <div class="expr">
      <div class="p">${idx+1}. ${e.phrase}</div>
      <div class="k"><b>Meaning:</b> ${e.meaning}</div>
      <div class="k"><b>Nuance:</b> <span class="muted">${e.nuance}</span></div>
      <div class="k"><b>Mini situation:</b> <span class="muted">${e.mini}</span></div>
      <div class="k">
        <button class="primary" onclick="(function(){ window.__speakLine(${JSON.stringify(e.phrase)}); })()">▶ Phrase</button>
        <button onclick="(function(){ window.__speakLine(${JSON.stringify(e.mini)}); })()">▶ Mini</button>
      </div>
    </div>
  `).join("");

  // story
  storyBox.textContent = d.story;
  // keep script hidden by default
  storyBox.classList.add("hidden");

  // understand (a)
  understandBox.innerHTML = d.understand.map(q=>`
    <div class="q"><b>${q}</b></div>
    <textarea placeholder="Answer in English (or speak out loud)"></textarea>
    <div class="hr"></div>
  `).join("");

  // expr quiz (b)
  exprQuizBox.innerHTML = d.exprQuiz.map((item, qi)=>`
    <div class="q"><b>Q${qi+1}. ${item.prompt}</b></div>
    <div class="options" data-ans="${escapeHtml(item.answer)}">
      ${item.options.map(opt=>`
        <div class="opt" onclick="window.__choose(this, ${JSON.stringify(item.answer)})">${escapeHtml(opt)}</div>
      `).join("")}
    </div>
    <div class="hr"></div>
  `).join("");

  // speaking (c)
  speakBox.innerHTML = d.speak.map((q, i)=>`
    <div class="q"><b>${q}</b></div>
    <textarea placeholder="Type your answer, then speak it out loud (40–60 sec)"></textarea>
    <div class="muted small">Tip: (1) context (2) what happened (3) how you felt (4) what you learned.</div>
    <div class="hr"></div>
  `).join("");
}

function escapeHtml(str){
  return (str||"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;");
}

// expose helpers for inline onclick
window.__choose = function(el, answer){
  const group = el.parentElement;
  // lock after first choice? no—allow retry: reset styles
  [...group.querySelectorAll(".opt")].forEach(o=>{
    o.classList.remove("correct","wrong");
  });
  const picked = el.textContent.trim();
  if(picked === answer){
    el.classList.add("correct");
  } else {
    el.classList.add("wrong");
    // highlight correct one
    const correct = [...group.querySelectorAll(".opt")].find(o=>o.textContent.trim()===answer);
    if(correct) correct.classList.add("correct");
  }
}

window.__speakLine = function(text){
  speak(text);
}

// init
initDays();
initVoices();
render();
</script>
</body>
</html>
